<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>我们在学习DRF在学什么？ | Taoya</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+TC|Open+Sans|Poppins|Source+Sans+Pro|Ubuntu&amp;display=swap">
    <script src="/parallax.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/gsap/3.2.6/gsap.min.js"></script>
    <meta name="description" content="多言数穷，不如守中">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.00fdc26d.css" as="style"><link rel="preload" href="/assets/js/app.e968a4dd.js" as="script"><link rel="preload" href="/assets/js/7.96aa0c69.js" as="script"><link rel="preload" href="/assets/js/69.5cbd049c.js" as="script"><link rel="prefetch" href="/assets/js/1.d886842f.js"><link rel="prefetch" href="/assets/js/10.b4cbacd4.js"><link rel="prefetch" href="/assets/js/11.4dcc70b0.js"><link rel="prefetch" href="/assets/js/12.5d3cae48.js"><link rel="prefetch" href="/assets/js/13.81d52903.js"><link rel="prefetch" href="/assets/js/14.54e547ee.js"><link rel="prefetch" href="/assets/js/15.4c18c262.js"><link rel="prefetch" href="/assets/js/16.df779644.js"><link rel="prefetch" href="/assets/js/17.51c1142c.js"><link rel="prefetch" href="/assets/js/18.c2ba6705.js"><link rel="prefetch" href="/assets/js/19.afccd4f0.js"><link rel="prefetch" href="/assets/js/2.258cf35c.js"><link rel="prefetch" href="/assets/js/20.9523cfa0.js"><link rel="prefetch" href="/assets/js/21.02d839bd.js"><link rel="prefetch" href="/assets/js/22.c1d1793f.js"><link rel="prefetch" href="/assets/js/23.7460123d.js"><link rel="prefetch" href="/assets/js/24.057d205c.js"><link rel="prefetch" href="/assets/js/25.ba1eca7d.js"><link rel="prefetch" href="/assets/js/26.d87b38f7.js"><link rel="prefetch" href="/assets/js/27.fe61ab21.js"><link rel="prefetch" href="/assets/js/28.9e740e50.js"><link rel="prefetch" href="/assets/js/29.99d5be00.js"><link rel="prefetch" href="/assets/js/30.7e8c0f07.js"><link rel="prefetch" href="/assets/js/31.b439d209.js"><link rel="prefetch" href="/assets/js/32.9f05d0df.js"><link rel="prefetch" href="/assets/js/33.4b40efcb.js"><link rel="prefetch" href="/assets/js/34.132985d1.js"><link rel="prefetch" href="/assets/js/35.7cde77d1.js"><link rel="prefetch" href="/assets/js/36.b545972f.js"><link rel="prefetch" href="/assets/js/37.cec0433f.js"><link rel="prefetch" href="/assets/js/38.3cf782c0.js"><link rel="prefetch" href="/assets/js/39.1fd576f4.js"><link rel="prefetch" href="/assets/js/40.e0464a53.js"><link rel="prefetch" href="/assets/js/41.895b1fd4.js"><link rel="prefetch" href="/assets/js/42.b22b4e9b.js"><link rel="prefetch" href="/assets/js/43.5845fd06.js"><link rel="prefetch" href="/assets/js/44.a4499e5c.js"><link rel="prefetch" href="/assets/js/45.0ea716a8.js"><link rel="prefetch" href="/assets/js/46.3907aa87.js"><link rel="prefetch" href="/assets/js/47.1e1a704a.js"><link rel="prefetch" href="/assets/js/48.0dc170a9.js"><link rel="prefetch" href="/assets/js/49.1a0758db.js"><link rel="prefetch" href="/assets/js/5.a5f98c38.js"><link rel="prefetch" href="/assets/js/50.d63db71b.js"><link rel="prefetch" href="/assets/js/51.99acc1e9.js"><link rel="prefetch" href="/assets/js/52.baa0f589.js"><link rel="prefetch" href="/assets/js/53.94234cfe.js"><link rel="prefetch" href="/assets/js/54.59e756da.js"><link rel="prefetch" href="/assets/js/55.66f2aa88.js"><link rel="prefetch" href="/assets/js/56.d3a9b6cc.js"><link rel="prefetch" href="/assets/js/57.adaa6ff2.js"><link rel="prefetch" href="/assets/js/58.120ccc59.js"><link rel="prefetch" href="/assets/js/59.81a7b043.js"><link rel="prefetch" href="/assets/js/6.54279ef5.js"><link rel="prefetch" href="/assets/js/60.8dc3ecd1.js"><link rel="prefetch" href="/assets/js/61.41dbc57b.js"><link rel="prefetch" href="/assets/js/62.07a98ad1.js"><link rel="prefetch" href="/assets/js/63.6b8f01dc.js"><link rel="prefetch" href="/assets/js/64.61f885bf.js"><link rel="prefetch" href="/assets/js/65.600c7af4.js"><link rel="prefetch" href="/assets/js/66.c1d457b0.js"><link rel="prefetch" href="/assets/js/67.678f428f.js"><link rel="prefetch" href="/assets/js/68.02d8e5dc.js"><link rel="prefetch" href="/assets/js/70.884b8fc6.js"><link rel="prefetch" href="/assets/js/71.5dceefa9.js"><link rel="prefetch" href="/assets/js/72.3000a87b.js"><link rel="prefetch" href="/assets/js/73.f5aa908c.js"><link rel="prefetch" href="/assets/js/74.c3c2262b.js"><link rel="prefetch" href="/assets/js/75.081df5c1.js"><link rel="prefetch" href="/assets/js/76.86ed3a20.js"><link rel="prefetch" href="/assets/js/77.02d42d05.js"><link rel="prefetch" href="/assets/js/78.fcb7b111.js"><link rel="prefetch" href="/assets/js/8.31b10017.js"><link rel="prefetch" href="/assets/js/9.24d6651a.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.eb9498ce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.00fdc26d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="taolin"><header class="tl-header"><div class="wrap"><div class="tl-logo"><h1><a href="/" class="router-link-active"><svg width="360" height="360" viewBox="0 0 360 360" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><rect width="360" height="360" fill="black"></rect> <path d="M314 217.328C314 222.203 312.453 228.719 309.359 236.875C301.391 258.25 286.109 274.703 263.516 286.234C243.734 296.359 221.469 301.422 196.719 301.422C163.25 301.422 137.984 292.516 120.922 274.703C105.453 258.578 97.7188 236.5 97.7188 208.469C97.7188 186.062 103.016 162.484 113.609 137.734C121.016 120.672 128.562 107.266 136.25 97.5156C109.438 100.516 85.4375 110.406 64.25 127.188C63.125 128.406 62.375 128.312 62 126.906C60.0312 114.344 57.4531 93.9062 54.2656 65.5938C54.3594 65.0312 54.9219 64.5625 55.9531 64.1875C130.203 70.4688 207.5 73.6094 287.844 73.6094C289.438 73.6094 290 74.5938 289.531 76.5625C279.688 115.281 273.641 146.266 271.391 169.516C264.641 168.484 255.922 166.75 245.234 164.312C240.172 162.625 237.641 160.047 237.641 156.578C237.641 154.703 238.344 150.531 239.75 144.062C241.25 137.5 242 132.625 242 129.438C242 124.844 240.547 121.609 237.641 119.734C220.859 108.672 207.547 102.438 197.703 101.031C180.734 133 172.25 168.391 172.25 207.203C172.25 228.766 175.484 246.484 181.953 260.359C188.891 275.453 198.453 283 210.641 283C219.734 283 229.719 279.391 240.594 272.172C250.719 265.328 255.781 259.797 255.781 255.578C255.781 253.891 255.219 253.047 254.094 253.047C239.938 250.891 227.797 246.25 217.672 239.125C205.672 230.781 199.672 220.656 199.672 208.75C199.672 202.375 203.891 197.125 212.328 193C220.859 188.875 232.391 186.812 246.922 186.812C253.391 186.812 260.984 187.375 269.703 188.5C299.234 192.438 314 202.047 314 217.328Z" fill="white"></path></g> <defs><clipPath id="clip0"><rect width="360" height="360" fill="white"></rect></clipPath></defs></svg></a></h1> <span>Taoya</span></div> <nav class="tl-menu"><ul class="tl-menu-list"><li class="tl-menu-item"><a href="/blog/"><span>技术</span> <svg xmlns="http://www.w3.org/2000/svg" width="38" height="4" viewBox="0 0 53 4" fill="none"><g clip-path="url(#clip0)"><path d="M51.9 3C49 3 49 1 46.2 1c-2.8 0-2.8 2-5.7 2-2.8 0-2.8-2-5.7-2C32 1 32 3 29.1 3c-2.8 0-2.8-2-5.7-2-2.8 0-2.8 2-5.6 2S15 1 12.1 1C9.5 1 9.5 3 6.7 3 3.8 3 3.8 1 1 1" stroke="#404040" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path></g><defs><clipPath id="clip0"><rect width="52.9" height="4" fill="#404040"></rect></clipPath></defs></svg></a></li><li class="tl-menu-item"><a href="/about/"><span>关于</span> <svg xmlns="http://www.w3.org/2000/svg" width="38" height="4" viewBox="0 0 53 4" fill="none"><g clip-path="url(#clip0)"><path d="M51.9 3C49 3 49 1 46.2 1c-2.8 0-2.8 2-5.7 2-2.8 0-2.8-2-5.7-2C32 1 32 3 29.1 3c-2.8 0-2.8-2-5.7-2-2.8 0-2.8 2-5.6 2S15 1 12.1 1C9.5 1 9.5 3 6.7 3 3.8 3 3.8 1 1 1" stroke="#404040" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path></g><defs><clipPath id="clip0"><rect width="52.9" height="4" fill="#404040"></rect></clipPath></defs></svg></a></li><li class="tl-menu-item"><a href="/life/"><span>记录</span> <svg xmlns="http://www.w3.org/2000/svg" width="38" height="4" viewBox="0 0 53 4" fill="none"><g clip-path="url(#clip0)"><path d="M51.9 3C49 3 49 1 46.2 1c-2.8 0-2.8 2-5.7 2-2.8 0-2.8-2-5.7-2C32 1 32 3 29.1 3c-2.8 0-2.8-2-5.7-2-2.8 0-2.8 2-5.6 2S15 1 12.1 1C9.5 1 9.5 3 6.7 3 3.8 3 3.8 1 1 1" stroke="#404040" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path></g><defs><clipPath id="clip0"><rect width="52.9" height="4" fill="#404040"></rect></clipPath></defs></svg></a></li></ul> <div class="tl-menu-trigger"><button class="menu-btn"><svg viewBox="0 0 64 48"><path d="M19,15 L45,15 C70,15 58,-2 49.0177126,7 L19,37"></path> <path d="M19,24 L45,24 C61.2371586,24 57,49 41,33 L32,24"></path> <path d="M45,33 L19,33 C-8,33 6,-2 22,14 L45,37"></path></svg></button></div> <div class="tl-hamburger"><div class="menu-secondary-background-color"></div> <div class="tl-menu-overlay"><div class="tl-f-nav-list"><div class="menu-background"></div> <div class="container"><div class="tl-f-nav-col"><h3 class="tl-f-nav-item"><a href="/blog"><div class="inner"><div class="tl-menu-content"><div class="tl-menu-index">
                                       01
                                   </div> <div class="tl-menu-name">
                                       技术
                                   </div></div> <div class="tl-menu-icon"><div class="tl-menu-icon_typeSVG"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 17 17"><g fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" transform="rotate(-135 7.533 9.872)"><path d="M7.80044955,21.4512363 L7.81236952,0.231533347" style="stroke-dashoffset:0;stroke-dasharray:22.2197px, 32.2197px;"></path> <path d="M15.601 13.651 7.8 21.451 0 13.651" style="stroke-dashoffset:0;stroke-dasharray:none;"></path></g></svg></div></div> <div class="tl-menu-border"></div></div></a></h3><h3 class="tl-f-nav-item"><a href="/about"><div class="inner"><div class="tl-menu-content"><div class="tl-menu-index">
                                       02
                                   </div> <div class="tl-menu-name">
                                       关于
                                   </div></div> <div class="tl-menu-icon"><div class="tl-menu-icon_typeSVG"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 17 17"><g fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" transform="rotate(-135 7.533 9.872)"><path d="M7.80044955,21.4512363 L7.81236952,0.231533347" style="stroke-dashoffset:0;stroke-dasharray:22.2197px, 32.2197px;"></path> <path d="M15.601 13.651 7.8 21.451 0 13.651" style="stroke-dashoffset:0;stroke-dasharray:none;"></path></g></svg></div></div> <div class="tl-menu-border"></div></div></a></h3><h3 class="tl-f-nav-item"><a href="/life"><div class="inner"><div class="tl-menu-content"><div class="tl-menu-index">
                                       03
                                   </div> <div class="tl-menu-name">
                                       生活记录
                                   </div></div> <div class="tl-menu-icon"><div class="tl-menu-icon_typeSVG"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 17 17"><g fill="none" fill-rule="evenodd" stroke="#000" stroke-linecap="round" stroke-linejoin="round" transform="rotate(-135 7.533 9.872)"><path d="M7.80044955,21.4512363 L7.81236952,0.231533347" style="stroke-dashoffset:0;stroke-dasharray:22.2197px, 32.2197px;"></path> <path d="M15.601 13.651 7.8 21.451 0 13.651" style="stroke-dashoffset:0;stroke-dasharray:none;"></path></g></svg></div></div> <div class="tl-menu-border"></div></div></a></h3></div></div></div></div></div></nav></div></header> <div id="article-post" data-scroll=""><main class="container"><div class="back"><div class="icon-wrap"><svg aria-hidden="true" class="icon"><use xlink:href="#icon-fanhui"></use></svg></div></div> <header><h1 class="title">我们在学习DRF在学什么？</h1> <div class="time"><span class="month">06</span> <span>/ <span>05</span></span></div></header> <article class="tl-article-container"><!----> <div class="content__default"><div class="custom-block warning"><h3 id="概念"><a href="#概念" class="header-anchor"></a> 概念</h3> <p><strong>组件</strong></p> <p>渲染器、解析器</p> <hr> <ul><li><p>RESTful规范</p></li> <li><p>DRF序列化 | 反序列化</p></li> <li><p>DRF视图 | 路由</p></li> <li><p>DRF版本</p></li> <li><p>DRF认证</p></li> <li><p>权限</p></li> <li><p>频率</p></li> <li><p>分页</p></li></ul></div> <h3 id="restful规范"><a href="#restful规范" class="header-anchor"></a> RESTful规范</h3> <p>在web中，只要有被引用的必要都叫资源。</p> <p>每个URI代表一个资源，独一无二的。</p> <p>客户端通过HTTP的方法，对服务器端资源进行操作；</p> <p>客户端和服务器之间，传递这种资源的某种表现层；</p> <p>通过超链接的指引，实现&quot;表现层状态转移&quot;。</p> <blockquote><p>规范</p></blockquote> <ol><li><p>面向资源编程
　　每个URL代表一种资源，URL中尽量不要用动词，要用名词。</p></li> <li><p>根据method不同，进行不同的操作
　　GET/POST/PUT/DELETE/PATCH</p></li> <li><p>在URL中体现版本</p></li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">/</span>v1<span class="token operator">/</span>book
<span class="token operator">/</span>v2<span class="token operator">/</span>book
</code></pre></div><ol start="4"><li>URL过滤条件</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code>/v1/book?page<span class="token operator">=</span><span class="token number">2</span>
</code></pre></div><ol start="5"><li>响应状态码</li></ol> <h2 id="序列化与反序列化"><a href="#序列化与反序列化" class="header-anchor"></a> 序列化与反序列化</h2> <p><strong>序列化</strong>是：数据对象从数据库中查出，通过instance传入序列化器中，必须通过data属性才能将序列化后的数据传给前端，不能直接传序列化对象</p> <p><strong>反序列化</strong>是：数据是通过request.data从前端获取到数据，通过data传入序列化器中进行校验，保存到数据库中</p> <blockquote><p>使用的两个阶段</p></blockquote> <p>客户端请求时：使用序列化器可以完成对数据的<u><strong>反序列化</strong></u>（就是前段往后端传递数据，反序列化之后保存数据）</p> <p>服务器响应时，使用序列化器可以完成对数据的<u><strong>序列化</strong></u>（服务器取出数据，序列化之后往前段发送展示）</p> <h3 id="反序列化流程"><a href="#反序列化流程" class="header-anchor"></a> 反序列化流程</h3> <p>先验证后保存</p> <p><strong>数据验证</strong></p> <p>使用序列化器反序列化。需要对数据进行校验后，才能获取验证成功的数据然后保存模型类对象</p> <p>在获取反序列化数据前。必须调用<code>is_valid()</code> 进行验证。成功True 失败False</p> <ul><li>通过可以通过<code>对象.validated_data</code>获取数据</li> <li>失败可以通过<code>对象.errors</code> 获取错误信息。</li></ul> <p><strong>保存数据</strong></p> <p>序列化类中必须重写create方法用于新增，重写update方法是修改</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 例子</span>
<span class="token number">1</span>）设置必填与选填序列化字段，设置校验规则
<span class="token number">2</span>）为需要额外校验的字段提供局部钩子函数，如果该字段不入库，且不参与全局钩子校验，可以将值取出校验 pop
<span class="token number">3</span>）为有联合关系的字段们提供全局钩子函数，如果某些字段不入库，可以将值取出校验
<span class="token number">4</span>）必须重写create方法，完成校验通过的数据入库工作，得到新增的对象


<span class="token keyword">class</span> <span class="token class-name">UserDeserializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1) 哪些字段必须反序列化</span>
    <span class="token comment"># 2) 字段都有哪些安全校验</span>
    <span class="token comment"># 3) 哪些字段需要额外提供校验  钩子函数</span>
    <span class="token comment"># 4) 哪些字段间存在联合校验</span>
    <span class="token comment"># 注：反序列化字段都是用来入库的，不会出现自定义方法属性，会出现可以设置校验规则的自定义属性,不入数据库的</span>
    name <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>
        max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>
        min_length<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>
        error_messages<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'max_length'</span><span class="token punctuation">:</span> <span class="token string">'太长'</span><span class="token punctuation">,</span>
            <span class="token string">'min_length'</span><span class="token punctuation">:</span> <span class="token string">'太短'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    phone <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    sex <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 自定义有校验规则的反序列化字段,例如确认密码字段re_pwd</span>
    re_pwd <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 局部钩子：validate_要校验的字段名(self, 当前要校验字段的值)</span>
    <span class="token comment"># 校验规则：校验通过返回原值，校验失败，抛出异常</span>
    <span class="token keyword">def</span> <span class="token function">validate_name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'g'</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 名字中不能出现g</span>
            <span class="token keyword">raise</span> exceptions<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">'名字非法，是个鸡贼！'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> value

    <span class="token comment"># 全局钩子：validate(self, 通过系统与局部钩子校验之后的所有数据)</span>
    <span class="token comment"># 校验规则：校验通过返回原值，校验失败，抛出异常</span>
    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#attrs是字典格式</span>
        pwd <span class="token operator">=</span> attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pwd'</span><span class="token punctuation">)</span>
        re_pwd <span class="token operator">=</span> attrs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'re_pwd'</span><span class="token punctuation">)</span>     <span class="token comment">#因为re_pwd不需要入数据库，所以在全局钩子校验中删除掉这个字段</span>
        <span class="token keyword">if</span> pwd <span class="token operator">!=</span> re_pwd<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> exceptions<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'pwd&amp;re_pwd'</span><span class="token punctuation">:</span> <span class="token string">'两次密码不一致'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> attrs

    <span class="token comment"># 要完成新增，必须自己重写 create 方法，validated_data是校验的数据</span>
    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 尽量在所有校验规则完毕之后，数据可以直接入库</span>
        <span class="token keyword">return</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>

</code></pre></div><h3 id="自定义序列化属性"><a href="#自定义序列化属性" class="header-anchor"></a> 自定义序列化属性</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
gender <span class="token operator">=</span> serializers<span class="token punctuation">.</span>SerializerMethodField<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_gender</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># choice类型的解释型值 get_字段_display() 来访问</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">.</span>get_sex_display<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="嵌套序列化"><a href="#嵌套序列化" class="header-anchor"></a> 嵌套序列化</h3> <p>正常情况下，我们不会有简单一个数据表来序列化。通常是多个表序列化。</p> <p>那我们就需要考虑多表如何嵌套序列化</p> <p><strong>三种方法</strong></p> <p>直接在models中定义方法。 然后我们在序列化类中用fields引用即可。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 1</span>
<span class="token comment"># models.py</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token decorator annotation punctuation">@property</span> 
    <span class="token keyword">def</span> <span class="token function">publish_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 出版社名称 (反向查询)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>name

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">author_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 获取作者列表 (反向查询所有)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># Serializer.py</span>
<span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Book
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token string">'publish_name'</span><span class="token punctuation">,</span> <span class="token string">'author_list'</span><span class="token punctuation">,</span> <span class="token string">'authors'</span><span class="token punctuation">)</span>

</code></pre></div><p>第二种方法：引用其他模型</p> <div class="language-python extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-python"><code><span class="token comment"># Serializer.py</span>
<span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    authors <span class="token operator">=</span> AuthorSerializer<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Book
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'authors'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><p>第三种方法： 自定义字段</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Serializer.py</span>
<span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    authors <span class="token operator">=</span> <span class="token string">'Halo'</span>
    
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Book
        fields <span class="token operator">=</span> <span class="token string">'__all__'</span>
</code></pre></div><hr> <p>序列化时，将模型类传入<code>instance</code>参数</p> <p>反序列化时，将要被反序列化的数据传入<code>data</code>参数</p> <p>除了instance和data参数。在构造Serializer对象。还可以通过context参数添加额外数据。</p> <h3 id="验证"><a href="#验证" class="header-anchor"></a> 验证</h3> <ul><li><p>单个字段验证</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> validate_字段<span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> value
</code></pre></div></li> <li><p>验证器<code>validators</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#attrs是字典格式</span>
	<span class="token keyword">return</span> attrs
</code></pre></div></li></ul> <h2 id="视图"><a href="#视图" class="header-anchor"></a> 视图</h2> <p>django中写CBV的时候继承的是View，rest_framework继承的是APIView 。</p> <p><img src="http://alicdn.itaolaity.com/img/20200608181003.png" alt=""></p> <h2 id="路由"><a href="#路由" class="header-anchor"></a> 路由</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouter

router <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">r&quot;book&quot;</span><span class="token punctuation">,</span> BookView<span class="token punctuation">)</span>

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span>router<span class="token punctuation">.</span>urls
</code></pre></div><h2 id="解析器"><a href="#解析器" class="header-anchor"></a> 解析器</h2> <p>解析器的作用就是服务端接收客户端传过来的数据，把数据解析成自己想要的数据类型的过程。</p> <p>本质就是对请求体中的数据进行解析。</p> <p><strong>局部使用</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>parser_classes <span class="token operator">=</span> <span class="token punctuation">[</span>JSONParser<span class="token punctuation">,</span><span class="token punctuation">]</span>
</code></pre></div><p><strong>全局使用</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># rest_framework.parsers.BaseParser</span>

<span class="token comment">#默认的解析器</span>
<span class="token string">'DEFAULT_PARSER_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
	<span class="token string">'rest_framework.parsers.JSONParser'</span><span class="token punctuation">,</span>
    <span class="token string">'rest_framework.parsers.FormParser'</span><span class="token punctuation">,</span>
    <span class="token string">'rest_framework.parsers.MultiPartParser'</span>
<span class="token punctuation">)</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/326318/1591100014871-8250b9fe-1eb7-412c-acf0-3ca957bff9ed.png" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2020/png/326318/1591100014871-8250b9fe-1eb7-412c-acf0-3ca957bff9ed.png" alt="img"></p> <h2 id="渲染器"><a href="#渲染器" class="header-anchor"></a> 渲染器</h2> <p>默认的渲染器</p> <p><code>rest_framework.settings.py</code></p> <div class="language-python extra-class"><pre class="language-python"><code>DEFAULTS <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 渲染器</span>
    <span class="token string">'DEFAULT_RENDERER_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">'rest_framework.renderers.JSONRenderer'</span><span class="token punctuation">,</span>
        <span class="token string">'rest_framework.renderers.BrowsableAPIRenderer'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor"></a> 参考</h2> <p>https://www.cnblogs.com/study-learning/p/10126773.html</p> <p>https://www.cnblogs.com/wangcuican/p/11748025.html</p></div></article> <div class="tl-article-toc"><div class="vuepress-toc-item vuepress-toc-h3 active"><a href="#概念">概念</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#restful规范">RESTful规范</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#序列化与反序列化">序列化与反序列化</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#反序列化流程">反序列化流程</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#自定义序列化属性">自定义序列化属性</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#嵌套序列化">嵌套序列化</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#验证">验证</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#视图">视图</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#路由">路由</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#解析器">解析器</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#渲染器">渲染器</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#参考">参考</a></div></div></main></div></div><div class="global-ui"><div class="reading-progress bottom" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div></div></div>
    <script src="/assets/js/app.e968a4dd.js" defer></script><script src="/assets/js/7.96aa0c69.js" defer></script><script src="/assets/js/69.5cbd049c.js" defer></script>
  </body>
</html>
