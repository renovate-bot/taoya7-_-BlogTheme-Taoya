(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{680:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Django REST framework 框架是一个用于构建Web API 的强大而又灵活的工具。通常简称为DRF框架 或 REST framework。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("特点：")])]),t._v(" "),a("p",[t._v("提供了定义序列化器Serializer的方法，可以"),a("u",[t._v("快速根据 Django ORM 或者其它库自动序列化/反序列化")]),t._v("；")]),t._v(" "),a("p",[t._v("​       丰富的定制层级："),a("u",[t._v("函数视图、类视图、视图集合到自动生成 API")]),t._v("。 django 针对 Web 开发中常见的处理逻辑，提供了各种通用视图函数，以提高代码的复用性，减少开发者的工作量。django-rest-framework 同样针对 RESTful API 开发中常见的处理逻辑，提供了各种通用视图函数")]),t._v(" "),a("p",[a("u",[t._v("多种身份认证和权限认证方式的支持")])]),t._v(" "),a("p",[a("u",[t._v("内置了限流系统；")])]),t._v(" "),a("p",[a("u",[t._v("自动生成API文档。")]),t._v("前后端分离开发")]),t._v(" "),a("p",[t._v("​           除此以外，django-rest-framework 还提供了"),a("strong",[t._v("分页（Pagination）")]),t._v("、"),a("strong",[t._v("API 版本控制（Versioning")]),t._v("）、"),a("strong",[t._v("缓存（Caching）")]),t._v("、**限流（Throtting）**等各种功能类")]),t._v(" "),a("p",[a("strong",[t._v("安装:")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" djangorestframework\n")])])]),a("p",[a("code",[t._v("Python (3.7.3)")])]),t._v(" "),a("p",[a("code",[t._v("Django(3.0.1)")])])]),t._v(" "),a("p",[t._v("我们首先来回顾一下传统的基于模板引擎的 django 开发工作流：")]),t._v(" "),a("ol",[a("li",[t._v("绑定 URL 和视图函数。当用户访问某个 URL 时，调用绑定的视图函数进行处理。")]),t._v(" "),a("li",[t._v("编写视图函数的逻辑。视图中通常涉及数据库的操作。")]),t._v(" "),a("li",[t._v("在视图中渲染 HTML 模板，返回 HTTP 响应。")])]),t._v(" "),a("p",[t._v("其实，基于 django-rest-framework 的 RESTful API 的开发，过程是完全类似的：")]),t._v(" "),a("ol",[a("li",[t._v("绑定 URL 和视图函数。当用户访问某个 URL 时，调用绑定的视图函数进行处理。")]),t._v(" "),a("li",[t._v("编写视图函数的逻辑，根据 HTTP 请求类型，对请求的资源进行相应操作，这个过程通常涉及数据库的操作。")]),t._v(" "),a("li",[t._v("使用约定的资源描述格式（例如 XML 或者 JSON）序列化资源并将数据返回给客户端（通过 HTTP 响应）。")])]),t._v(" "),a("h2",{attrs:{id:"_1-序列化器serializer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-序列化器serializer"}},[t._v("#")]),t._v(" 1-序列化器Serializer")]),t._v(" "),a("p",[a("code",[t._v("rest_framework.serializers.Serializer")])]),t._v(" "),a("p",[a("strong",[t._v("作用")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("进行数据的校验")])]),t._v(" "),a("li",[a("p",[t._v("对数据对象进行转换 ORM->JSON")])]),t._v(" "),a("li",[a("p",[t._v("可以操作数据增删改查")])])]),t._v(" "),a("h3",{attrs:{id:"_1-0-serializer类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-serializer类"}},[t._v("#")]),t._v(" 1-0 Serializer类")]),t._v(" "),a("p",[t._v("DRF中的"),a("code",[t._v("Serializer")]),t._v("使用类来定义，须继承自"),a("code",[t._v("rest_framework.serializers.Serializer")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""图书数据序列化器"""')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IntegerField"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" read_only"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    title "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CharField"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" max_length"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",[a("code",[t._v("read_only")]),t._v("指定只参与序列化，"),a("code",[t._v("max_length")]),t._v("限定字符串最大长度。字段里不传参数序列化与反序列化都参与")]),t._v(" "),a("p",[a("code",[t._v("serializer")]),t._v("不是只能为数据库模型类定义，也可以为非数据库模型类的数据定义。"),a("code",[t._v("serializer")]),t._v("是独立于数据库之外的存在")]),t._v(" "),a("ul",[a("li",[t._v("read_only")])]),t._v(" "),a("p",[t._v("read_only表示只能读，不能进行修改。例如定义序列化器时，id字段通常指定read_only=True。在序列化时，即对象转为字典、JSON字符串时，字典、JSON字符串"),a("strong",[t._v("包含")]),t._v("着id字段。但是反序列化时，即JSON字符串、字典转换为对象时，在参数校验的时候，即使字典有id的键值对，"),a("strong",[t._v("校验不会出错")]),t._v("，但是校验后的数据"),a("strong",[t._v("不会有")]),t._v("id这个字段，所以id也"),a("strong",[t._v("不会存进数据库")]),t._v("。")]),t._v(" "),a("ul",[a("li",[t._v("write_only")])]),t._v(" "),a("p",[t._v("write_only表示只能写，不能读。例如定义序列化器时，password字段（还有短信验证码等）通常指定write_only=True。在序列化时，即对象转为字典、JSON字符串时，字典、JSON字符串"),a("strong",[t._v("不会包含")]),t._v("着字段。但是反序列化时，即JSON字符串、字典转换为对象时，在参数校验的时候，"),a("strong",[t._v("校验通过")]),t._v("，而且校验后的数据"),a("strong",[t._v("有")]),t._v("password这个字段，并且"),a("strong",[t._v("能存进数据库")]),t._v("。")]),t._v(" "),a("p",[t._v("Serializer的构造函数的参数")]),t._v(" "),a("ol",[a("li",[t._v("instance 需要传递一个ORM对象，或者是一个querySet对象。用来将ORM转化Json的")]),t._v(" "),a("li",[t._v("data 把需要验证的数据传递给data")]),t._v(" "),a("li",[t._v("many 如果instance是一个querySet对象 需要设置为True默认为False")])])]),t._v(" "),a("h4",{attrs:{id:"通用参数说明："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通用参数说明："}},[t._v("#")]),t._v(" 通用参数说明：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("read_only")])]),t._v(" "),a("td",[t._v("表明该字段仅用于序列化输出，默认False")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("write_only")])]),t._v(" "),a("td",[t._v("表明该字段仅用于反序列化输入，默认False")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("required")])]),t._v(" "),a("td",[t._v("表明该字段在反序列化时必须输入，默认True")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("default")])]),t._v(" "),a("td",[t._v("反序列化时使用的默认值")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("allow_null")])]),t._v(" "),a("td",[t._v("表明该字段是否允许传入None，默认False")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("validators")])]),t._v(" "),a("td",[t._v("该字段使用的验证器")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("error_messages")])]),t._v(" "),a("td",[t._v("包含错误编号与错误信息的字典")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("label")])]),t._v(" "),a("td",[t._v("用于HTML展示API页面时，显示的字段名称")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("help_text")])]),t._v(" "),a("td",[t._v("用于HTML展示API页面时，显示的字段帮助提示信息")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-1序列化使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1序列化使用"}},[t._v("#")]),t._v(" 1-1序列化使用")]),t._v(" "),a("p",[a("strong",[t._v("使用")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("最基本的使用")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("获取单个序列化数据")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data\n")])])])]),t._v(" "),a("li",[a("p",[t._v("获取多个序列化数据")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("serializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("books"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" many"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nserializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data\n")])])])])])]),t._v(" "),a("li",[a("p",[t._v("关联对象嵌套序列化")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("heroes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" HeroInfoSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("many"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据指定的HeroSerialzier序列化中指定的字段返回")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"_1-2反序列化使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2反序列化使用"}},[t._v("#")]),t._v(" 1-2反序列化使用")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",[t._v("在使用序列化器进行反序列化时，需要对数据进行验证后，才获取成功数据保存模型对象")]),t._v(" "),a("p",[t._v("在获取反序列化数据前，必须调用is_valid() 方法进行验证。 成功True 失败False")]),t._v(" "),a("p",[t._v("验证成功通过序列化器对象的validated_data 属性获取数据")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("View"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更新操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从模型取数据")]),t._v("\n            book "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" JsonResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'errors'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'未找到该书'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\n        ser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        ser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_valid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("raise_exception"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("同时序列化器提供了其他验证方式")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("验证单个字段")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("validated_title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'python'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ValidationError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'书名python错误'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" value\n")])])])]),t._v(" "),a("li",[a("p",[t._v("验证多个字段")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" \t\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("validate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" attrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        bread "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" attrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bread'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        bcomment "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" attrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bcomment'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" bread "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" bcomment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ValidationError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'阅读量小于评论量'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" attrs\n")])])])])]),t._v(" "),a("p",[a("strong",[t._v("保存数据")])]),t._v(" "),a("p",[t._v("验证成功后，就可以将数据保存成模型存入数据库。")]),t._v(" "),a("p",[t._v("可以通过实现"),a("code",[t._v("create()")]),t._v("和"),a("code",[t._v("update()")]),t._v("两个方法来实现")]),t._v(" "),a("h3",{attrs:{id:"_1-3-模型类序列化器modelserializer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-模型类序列化器modelserializer"}},[t._v("#")]),t._v(" 1-3 模型类序列化器ModelSerializer")]),t._v(" "),a("p",[t._v("如果我们想要"),a("u",[t._v("使用序列化器对应的是Django的模型类")]),t._v("，DRF为我们提供了ModelSerializer模型类序列化器来帮助我们快速创建一个Serializer类")]),t._v(" "),a("blockquote",[a("p",[t._v("ModelSerializer与常规的Serializer相同，但提供了：")]),t._v(" "),a("ul",[a("li",[t._v("基于模型类自动生成一系列字段")]),t._v(" "),a("li",[t._v("基于模型类自动为Serializer生成validators，比如unique_together")]),t._v(" "),a("li",[t._v("包含默认的create()和update()的实现")])])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookInfoSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""图书数据序列化器"""')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo\n        fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__all__'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 返回所有字段")]),t._v("\n\nmodel 指明参照哪个模型类\nfields 指明为模型类的哪些字段生成\n")])])]),a("p",[t._v("可以通过"),a("code",[t._v("shell")]),t._v(" 命令查看具体实现")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" booktest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serializers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BookSerializer "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导入")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" serializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 序列化")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" serializer\nBookSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IntegerField"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("label"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ID'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" read_only"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h4",{attrs:{id:"指定字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定字段"}},[t._v("#")]),t._v(" 指定字段")]),t._v(" "),a("ol",[a("li",[t._v("使用 "),a("strong",[a("code",[t._v("fields")])]),t._v(" 来明确字段，"),a("code",[t._v("__all__")]),t._v("表名包含所有字段，也可以写明具体哪些字段")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookInfoSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""图书数据序列化器"""')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定根据哪个模型类来序列化")]),t._v("\n        fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'btitle'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bpub_date'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[t._v("使用 "),a("strong",[a("code",[t._v("exclude")])]),t._v(" 可以"),a("u",[t._v("明确排除掉哪些字段")])])]),t._v(" "),a("li",[a("p",[t._v("显示指明字段")])])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HeroInfoSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    hbook "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" HeroInfo\n        fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hname'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hgender'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hcomment'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hbook'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("指明只读字段")])]),t._v(" "),a("p",[t._v("​\t 可以通过"),a("strong",[t._v("read_only_fields")]),t._v("指明只读字段，即仅用于序列化输出的字段")]),t._v(" "),a("h4",{attrs:{id:"添加额外参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加额外参数"}},[t._v("#")]),t._v(" 添加额外参数")]),t._v(" "),a("p",[t._v("可以使用 "),a("strong",[a("code",[t._v("extra_kwargs")])]),t._v(" 参数为"),a("code",[t._v("ModelSerializer")]),t._v("添加或修改原有的选项参数")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookInfoSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""图书数据序列化器"""')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo\n        fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'btitle'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bpub_date'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bread'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bcomment'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        extra_kwargs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bread'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'min_value'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'required'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bcomment'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'min_value'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'required'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])]),t._v(" "),a("h2",{attrs:{id:"_2-视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-视图"}},[t._v("#")]),t._v(" 2.视图")]),t._v(" "),a("p",[a("code",[t._v("REST framework")]),t._v(" 传入DRF封装后视图的"),a("code",[t._v("request")]),t._v("对象不再是"),a("code",[t._v("Django")]),t._v("默认的"),a("code",[t._v("HttpRequest")]),t._v("对象，而是"),a("code",[t._v("REST framework")]),t._v("提供的扩展了"),a("code",[t._v("HttpRequest")]),t._v("类的**"),a("code",[t._v("Request")]),t._v("**类的对象")]),t._v(" "),a("h3",{attrs:{id:"_2-1请求对象request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1请求对象request"}},[t._v("#")]),t._v(" 2.1请求对象Request")]),t._v(" "),a("p",[t._v("REST framework 提供了"),a("strong",[t._v("Parser")]),t._v("解析器，在接收到请求后会自动根据Content-Type指明的请求数据类型（如JSON、表单等）将请求数据进行parse解析，解析为类字典对象保存到"),a("strong",[t._v("Request")]),t._v("对象中")]),t._v(" "),a("p",[a("strong",[t._v("Request对象的数据是自动根据前端发送数据的格式进行解析之后的结果。")])]),t._v(" "),a("p",[t._v("无论前端发送的哪种格式的数据，我们都可以以统一的方式读取数据。")]),t._v(" "),a("blockquote",[a("p",[t._v("无论前端发过来的是xml还是json，请求方式无论是POST还是PUT，都可以直接用request.data直接取一个字典出来")]),t._v(" "),a("p",[t._v("要继承APIView(或其子类)才能取得DRF的Request和Response")])]),t._v(" "),a("p",[t._v("request.query_params 查询参数。 为了代码更加清晰准确，推荐使用"),a("code",[t._v("request.query_params")]),t._v("，而不是Django中的"),a("code",[t._v("request.GET")]),t._v("，这样那够让你的代码更加明显的体现出-----任何HTTP方法类型都可能包含查询参数（query parameters），而不仅仅只是'GET'请求。")]),t._v(" "),a("h4",{attrs:{id:"data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data"}},[t._v("#")]),t._v(" data")]),t._v(" "),a("p",[a("code",[t._v("request.data")]),t._v(" 返回解析之后的请求体（表单、json）数据。类似于Django中标准的"),a("code",[t._v("request.POST")]),t._v("和 "),a("code",[t._v("request.FILES")]),t._v("属性，但提供如下特性：")]),t._v(" "),a("ul",[a("li",[t._v("包含了"),a("strong",[t._v("解析之后")]),t._v("的文件和非文件数据")]),t._v(" "),a("li",[t._v("包含了对POST、PUT、PATCH请求方式解析后的数据")]),t._v(" "),a("li",[t._v("利用了REST framework的parsers解析器，不仅支持表单类型数据，也支持JSON数据")])]),t._v(" "),a("h3",{attrs:{id:"_2-2-响应对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-响应对象"}},[t._v("#")]),t._v(" 2.2 响应对象")]),t._v(" "),a("p",[a("code",[t._v("rest_framework.response.Response")])]),t._v(" "),a("p",[t._v("REST framework提供了一个响应类"),a("code",[t._v("Response")]),t._v("，使用该类构造响应对象时，响应的具体数据内容会被转换（render渲染）成符合前端需求的类型")]),t._v(" "),a("blockquote",[a("p",[t._v("参数说明:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("data")]),t._v(": 为响应准备的序列化处理后的数据；")]),t._v(" "),a("li",[a("code",[t._v("status")]),t._v(": 状态码，默认200；")]),t._v(" "),a("li",[a("code",[t._v("template_name")]),t._v(": 模板名称，如果使用"),a("code",[t._v("HTMLRenderer")]),t._v(" 时需指明；")]),t._v(" "),a("li",[a("code",[t._v("headers")]),t._v(": 用于存放响应头信息的字典；")]),t._v(" "),a("li",[a("code",[t._v("content_type")]),t._v(": 响应数据的Content-Type，通常此参数无需传递，REST framework会根据前端所需类型数据来设置该参数。")])])]),t._v(" "),a("h3",{attrs:{id:"_2-3-状态码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-状态码"}},[t._v("#")]),t._v(" 2.3 状态码")]),t._v(" "),a("p",[a("code",[t._v("REST framewrok")]),t._v("在"),a("code",[t._v("rest_framework.status")]),t._v("模块中提供了常用状态码常量。")]),t._v(" "),a("blockquote",[a("p",[t._v("总是在你的视图中用数字的HTTP状态码会更加容易理解，并且如果你用其他错误代码表示错误，就不太容易注意到了。REST框架为每个状态码(status code)提供更明确的标识符，例如在状态(status)模型中的HTTP_400_BAD_REQUEST。用这些标识符代替纯数字的HTTP状态码是很好的注意")])]),t._v(" "),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200501135603.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serializer "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decorators "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" api_view\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Response "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Response")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" status "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# status")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@api_view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http_method_names"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''\n    展示所有图书\n    :param request:\n    :return:\n    '''")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        serializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" many"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        serializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_valid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义状态码")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HTTP_201_CREATED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" status"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HTTP_400_BAD_REQUEST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("如果返回所有图书列表，不用再像以前"),a("code",[t._v("JsonResponse")]),t._v("中需指定"),a("code",[t._v("safe=False")]),t._v("了")]),t._v(" "),a("h3",{attrs:{id:"_2-4-类视图apiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-类视图apiview"}},[t._v("#")]),t._v(" 2.4 类视图APIView")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("views"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("APIView\n")])])]),a("p",[a("code",[t._v("APIView")]),t._v("是REST framework提供的所有视图的基类，继承自Django的"),a("code",[t._v("View")]),t._v("父类")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("APIView")]),t._v("与"),a("code",[t._v("View")]),t._v("的不同之处在于：")]),t._v(" "),a("ul",[a("li",[t._v("传入到视图方法中的是REST framework的"),a("code",[t._v("Request")]),t._v("对象，而不是Django的"),a("code",[t._v("HttpRequeset")]),t._v("对象；")]),t._v(" "),a("li",[t._v("视图方法可以返回REST framework的"),a("code",[t._v("Response")]),t._v("对象，视图会为响应数据设置（render）符合前端要求的格式；")]),t._v(" "),a("li",[t._v("任何"),a("code",[t._v("APIException")]),t._v("异常都会被捕获到，并且处理成合适的响应信息；")]),t._v(" "),a("li",[t._v("在进行dispatch()分发前，会对请求进行身份认证、权限检查、流量控制")])])]),t._v(" "),a("blockquote",[a("h5",{attrs:{id:"支持定义的属性："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持定义的属性："}},[t._v("#")]),t._v(" 支持定义的属性：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("authentication_classes")]),t._v(" 列表或元祖，身份认证类")]),t._v(" "),a("li",[a("strong",[t._v("permissoin_classes")]),t._v(" 列表或元祖，权限检查类")]),t._v(" "),a("li",[a("strong",[t._v("throttle_classes")]),t._v(" 列表或元祖，流量控制类")])])]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("APIView")]),t._v("中仍以常规的类视图定义方法来实现get() 、post() 或者其他请求方式的方法")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("views "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" APIView\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Response\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# url(r'^books/$', views.BookListView.as_view()),")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        books "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        serializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("books"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" many"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-5-genericapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-genericapiview"}},[t._v("#")]),t._v(" 2.5 GenericAPIView")]),t._v(" "),a("p",[a("code",[t._v("rest_framework.generics.GenericAPIView")]),t._v("继承自"),a("code",[t._v("APIVIew")]),t._v("，增加了对于列表视图和详情视图可能用到的通用支持方法。通常使用时，可搭配一个或多个Mixin扩展类")]),t._v(" "),a("h5",{attrs:{id:"支持定义的属性：-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持定义的属性：-2"}},[t._v("#")]),t._v(" 支持定义的属性：")]),t._v(" "),a("ul",[a("li",[t._v("列表视图与详情视图通用：\n"),a("ul",[a("li",[a("strong",[t._v("queryset")]),t._v(" 列表视图的查询集")]),t._v(" "),a("li",[a("strong",[t._v("serializer_class")]),t._v(" 视图使用的序列化器")])])]),t._v(" "),a("li",[t._v("列表视图使用：\n"),a("ul",[a("li",[a("strong",[t._v("pagination_class")]),t._v(" 分页控制类")]),t._v(" "),a("li",[a("strong",[t._v("filter_backends")]),t._v(" 过滤控制后端")])])]),t._v(" "),a("li",[t._v("详情页视图使用：\n"),a("ul",[a("li",[a("strong",[t._v("lookup_field")]),t._v(" 查询单一数据库对象时使用的条件字段，默认为'"),a("code",[t._v("pk")]),t._v("'")]),t._v(" "),a("li",[a("strong",[t._v("lookup_url_kwarg")]),t._v(" 查询单一数据时URL中的参数关键字名称，默认与"),a("strong",[t._v("look_field")]),t._v("相同")])])])]),t._v(" "),a("h5",{attrs:{id:"提供的方法："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提供的方法："}},[t._v("#")]),t._v(" 提供的方法：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("列表视图与详情视图通用：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("get_queryset(self)")])]),t._v(" "),a("p",[t._v("返回视图使用的查询集，是列表视图与详情视图获取数据的基础，默认返回"),a("code",[t._v("queryset")]),t._v("属性，可以重写，例如：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_queryset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accounts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("get_serializer_class(self)")])]),t._v(" "),a("p",[t._v("返回序列化器类，默认返回"),a("code",[t._v("serializer_class")]),t._v("，可以重写，例如：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_serializer_class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_staff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" FullAccountSerializer\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" BasicAccountSerializer\n")])])])]),t._v(" "),a("li",[a("h5",{attrs:{id:"get-serializer-self-args-kwargs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#get-serializer-self-args-kwargs"}},[t._v("#")]),t._v(" get_serializer(self, *args, **kwargs)")]),t._v(" "),a("p",[t._v("返回序列化器对象，被其他视图或扩展类使用，如果我们在视图中想要获取序列化器对象，可以直接调用此方法。")]),t._v(" "),a("p",[a("strong",[t._v("注意，在提供序列化器对象的时候，REST framework会向对象的context属性补充三个数据：request、format、view，这三个数据对象可以在定义序列化器时使用。")])])])])]),t._v(" "),a("li",[a("p",[t._v("详情视图使用：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("get_object(self)")]),t._v(" 返回详情视图所需的模型类数据对象，默认使用"),a("code",[t._v("lookup_field")]),t._v("参数来过滤queryset。 在试图中可以调用该方法获取详情信息的模型类对象。")]),t._v(" "),a("p",[a("strong",[t._v("若详情访问的模型类对象不存在，会返回404。")])]),t._v(" "),a("p",[a("strong",[t._v("该方法会默认使用"),a("code",[t._v("APIView")]),t._v("提供的check_object_permissions方法检查当前对象是否有权限被访问。")])])])])])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("generics "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v("  GenericAPIView\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BooksView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GenericAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定查询集")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定序列化器")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''查询所有图书'''")]),t._v("\n        books "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_queryset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 获取查询集\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# book = self.get_object() 获取单一数据对象")]),t._v("\n        serializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("books"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" many "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#获取序列化器")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n         保存图书\n        """')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1、获取前端数据")]),t._v("\n        data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2、验证数据")]),t._v("\n        ser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        ser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_valid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("raise_exception"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3、保存数据")]),t._v("\n        ser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4、返回结果")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200501135319.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_3-扩展类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-扩展类"}},[t._v("#")]),t._v(" 3. 扩展类")]),t._v(" "),a("h3",{attrs:{id:"_3-1-mixins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-mixins"}},[t._v("#")]),t._v(" 3.1 Mixins")]),t._v(" "),a("blockquote",[a("p",[t._v("mixins 翻译 是 组件、混入的意思。")]),t._v(" "),a("p",[t._v("在DRF中针对获取列表、检索、创建等操作。都有响应的mixins")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" mixins\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" generics\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GenericAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    mixins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ListModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列表视图扩展类")]),t._v("\n    mixins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RetrieveModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 详情视图扩展类")]),t._v("\n    mixins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreateModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建视图扩展类")]),t._v("\n    mixins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UpdateModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更新视图扩展类")]),t._v("\n    mixins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DestroyModelMixin "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除视图扩展类")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''\n        图书控制层\n        列表 /book\n        新增 /book/\n        详情 /book/pk/\n        修改 /book/pk\n        删除 /book/pk\n    '''")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("retrieve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200501141515.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("ListModelMixin")])]),t._v(" "),a("p",[t._v("列表视图扩展类，提供"),a("code",[t._v("list(request, *args, **kwargs)")]),t._v("方法快速实现列表视图，返回200状态码。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mixins "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ListModelMixin\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BooksView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ListModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" GenericAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("CreateModelMixin")])]),t._v(" "),a("p",[t._v("创建视图扩展类，提供"),a("code",[t._v("create(request, *args, **kwargs)")]),t._v("方法快速实现创建资源的视图，成功返回201状态码。如果序列化器对前端发送的数据验证失败，返回400错误。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mixins "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CreateModelMixin\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BooksView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CreateModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" GenericAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    \n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("RetrieveModelMixin")])]),t._v(" "),a("p",[t._v("详情视图扩展类，提供"),a("code",[t._v("retrieve(request, *args, **kwargs)")]),t._v("方法，可以快速实现返回一个存在的数据对象。如果存在，返回200， 否则返回404。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BooksView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RetrieveModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" GenericAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("retrieve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("UpdateModelMixin")])]),t._v(" "),a("p",[t._v("更新视图扩展类，提供"),a("code",[t._v("update(request, *args, **kwargs)")]),t._v("方法，可以快速实现更新一个存在的数据对象。同时也提供"),a("code",[t._v("partial_update(request, *args, **kwargs)")]),t._v("方法，可以实现局部更新。")]),t._v(" "),a("p",[t._v("成功返回200，序列化器校验数据失败时，返回400错误。")]),t._v(" "),a("p",[a("strong",[t._v("DestroyModelMixin")])]),t._v(" "),a("p",[t._v("删除视图扩展类，提供"),a("code",[t._v("destroy(request, *args, **kwargs)")]),t._v("方法，可以快速实现删除一个存在的数据对象。成功返回204，不存在返回404。")]),t._v(" "),a("h3",{attrs:{id:"_3-2-generic类视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-generic类视图"}},[t._v("#")]),t._v(" 3.2 Generic类视图")]),t._v(" "),a("p",[t._v("同故宫mixin可以非常方便实现一些CRUD操作。")]),t._v(" "),a("blockquote",[a("h4",{attrs:{id:"createapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createapiview"}},[t._v("#")]),t._v(" CreateAPIView")]),t._v(" "),a("p",[t._v("实现创建数据的")]),t._v(" "),a("p",[t._v("提供 post 方法")]),t._v(" "),a("p",[t._v("继承自： GenericAPIView、CreateModelMixin")]),t._v(" "),a("h4",{attrs:{id:"listapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#listapiview"}},[t._v("#")]),t._v(" ListAPIView")]),t._v(" "),a("p",[t._v("实现获取列表的")]),t._v(" "),a("p",[t._v("提供 get 方法")]),t._v(" "),a("p",[t._v("继承自：GenericAPIView、ListModelMixin")]),t._v(" "),a("h4",{attrs:{id:"retireveapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#retireveapiview"}},[t._v("#")]),t._v(" RetireveAPIView")]),t._v(" "),a("p",[t._v("实现检索数据的")]),t._v(" "),a("p",[t._v("提供 get 方法")]),t._v(" "),a("p",[t._v("继承自: GenericAPIView、RetrieveModelMixin")]),t._v(" "),a("h4",{attrs:{id:"destoryapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#destoryapiview"}},[t._v("#")]),t._v(" DestoryAPIView")]),t._v(" "),a("p",[t._v("实现删除数据的")]),t._v(" "),a("p",[t._v("提供 delete 方法")]),t._v(" "),a("p",[t._v("继承自：GenericAPIView、DestoryModelMixin")]),t._v(" "),a("h4",{attrs:{id:"updateapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#updateapiview"}},[t._v("#")]),t._v(" UpdateAPIView")]),t._v(" "),a("p",[t._v("实现更新数据的")]),t._v(" "),a("p",[t._v("提供 put 和 patch 方法")]),t._v(" "),a("p",[t._v("继承自：GenericAPIView、UpdateModelMixin")]),t._v(" "),a("h4",{attrs:{id:"retrieveupdateapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#retrieveupdateapiview"}},[t._v("#")]),t._v(" RetrieveUpdateAPIView")]),t._v(" "),a("p",[t._v("提供 get、put、patch方法")]),t._v(" "),a("p",[t._v("继承自： GenericAPIView、RetrieveModelMixin、UpdateModelMixin")]),t._v(" "),a("h4",{attrs:{id:"retrieveupdatedestoryapiview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#retrieveupdatedestoryapiview"}},[t._v("#")]),t._v(" RetrieveUpdateDestoryAPIView")]),t._v(" "),a("p",[t._v("提供 get、put、patch、delete方法")]),t._v(" "),a("p",[t._v("继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" generics\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreateAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UpdateAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DestroyAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RetrieveAPIView\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer\n")])])]),a("h2",{attrs:{id:"_4-视图集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-视图集"}},[t._v("#")]),t._v(" 4.视图集")]),t._v(" "),a("blockquote",[a("p",[t._v("使用视图集"),a("code",[t._v("ViewSet")]),t._v("，可以将一系列逻辑相关的动作放到一个类中：")]),t._v(" "),a("ul",[a("li",[t._v("list() 提供一组数据")]),t._v(" "),a("li",[t._v("retrieve() 提供单个数据")]),t._v(" "),a("li",[t._v("create() 创建数据")]),t._v(" "),a("li",[t._v("update() 保存数据")]),t._v(" "),a("li",[t._v("destory() 删除数据")])]),t._v(" "),a("p",[t._v("ViewSet视图集类不再实现get()、post()等方法，而是实现动作 "),a("strong",[t._v("action")]),t._v(" 如 list() 、create() 等。")]),t._v(" "),a("p",[t._v("视图集只在使用as_view()方法的时候，才会将"),a("strong",[t._v("action")]),t._v("动作与具体请求方式对应上。")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookInfoViewSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("viewsets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 展示所有")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 展示单个")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("retrieve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("在设置路由时，我们可以如下操作")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("urlpatterns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'^books/$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BookInfoViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'list'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'^books/(?P<pk>\\d+)/$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BookInfoViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'retrieve'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h4",{attrs:{id:"action属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#action属性"}},[t._v("#")]),t._v(" action属性")]),t._v(" "),a("p",[t._v("在"),a("strong",[t._v("视图集")]),t._v("中，我们可以通过action对象属性来获取当前请求视图集时的action动作是哪个")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_serializer_class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("action "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" OrderCommitSerializer\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" OrderDataSerializera\n")])])]),a("h3",{attrs:{id:"_4-1-viewset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-viewset"}},[t._v("#")]),t._v(" 4.1 ViewSet")]),t._v(" "),a("p",[t._v("继承自APIView，作用也与APIView基本类似，提供了身份认证、权限校验、流量管理等。")]),t._v(" "),a("p",[t._v("在ViewSet中，没有提供任何动作action方法，需要我们自己实现action方法")]),t._v(" "),a("h3",{attrs:{id:"_4-2-genericviewset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-genericviewset"}},[t._v("#")]),t._v(" 4.2 GenericViewSet")]),t._v(" "),a("p",[t._v("继承自"),a("code",[t._v("GenericAPIView")]),t._v("，作用也与GenericAPIVIew类似，提供了get_object、get_queryset等方法便于列表视图与详情信息视图的开发")]),t._v(" "),a("h3",{attrs:{id:"_4-3-modelviewset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-modelviewset"}},[t._v("#")]),t._v(" 4.3 ModelViewSet")]),t._v(" "),a("p",[t._v("继承自"),a("code",[t._v("GenericAPIVIew")]),t._v("，同时包括了ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin。所以所有增删改查功能都具备")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  路由层")]),t._v("\nurl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'^books/$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" view_set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BooksModelViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'list'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nurl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'^books/(?P<pk>\\d+)/$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" view_set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BooksModelViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'retrieve'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'put'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'update'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'delete'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'destroy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-4-readonlymodelviewset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-readonlymodelviewset"}},[t._v("#")]),t._v(" 4.4 ReadOnlyModelViewSet")]),t._v(" "),a("p",[t._v("继承自"),a("code",[t._v("GenericAPIVIew")]),t._v("，同时包括了ListModelMixin、RetrieveModelMixin")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" viewsets\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserViewSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("viewsets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ReadOnlyModelViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    只读API\n    """')]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UserSerializer\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" routers\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urls "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" include"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("url\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创造和定义路由地址 ")]),t._v("\nroute "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" routers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DefaultRouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册路由地址")]),t._v("\nroute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"book"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" views"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BookView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nroute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tag'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("views"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TagView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nurlpatterns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urls\n")])])]),a("h3",{attrs:{id:"_4-5-定义附加action"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-定义附加action"}},[t._v("#")]),t._v(" 4.5 定义附加action")]),t._v(" "),a("p",[t._v("在视图集中，除了上述默认的方法动作外，还可以添加自定义动作。")]),t._v(" "),a("p",[t._v("添加自定义动作需要使用"),a("code",[t._v("rest_framework.decorators.action")]),t._v("装饰器。")]),t._v(" "),a("p",[t._v("以action装饰器装饰的方法名会作为action动作名，与list、retrieve等同。")]),t._v(" "),a("p",[t._v("action装饰器可以接收两个参数：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("methods")]),t._v(": 该action支持的请求方式，列表传递")]),t._v(" "),a("li",[t._v("detail: 表示是action中要处理的是否是视图资源的对象（即是否通过url路径获取主键）\n"),a("ul",[a("li",[t._v("True 表示使用通过URL获取的主键对应的数据对象")]),t._v(" "),a("li",[t._v("False 表示不使用URL获取主键")])])])]),t._v(" "),a("h3",{attrs:{id:"_4-6路由routers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6路由routers"}},[t._v("#")]),t._v(" 4.6路由Routers")]),t._v(" "),a("p",[t._v("对于视图集ViewSet，我们除了可以自己手动指明请求方式与动作action之间的对应关系外，还可以使用Routers来帮助我们快速实现路由信息。")]),t._v(" "),a("p",[t._v("REST framework提供了两个router")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("SimpleRouter")])])]),t._v(" "),a("li",[a("strong",[a("code",[t._v("DefaultRouter")])])])]),t._v(" "),a("p",[a("strong",[t._v("使用方法")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("） 创建router对象，并注册视图集\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" routers\n\nrouter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" routers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SimpleRouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'books'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BookInfoViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" base_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'book'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##############################")]),t._v("\nregister"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" viewset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" base_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" prefix 该视图集的路由前缀\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" viewset 视图集\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" base_name 路由名称的前缀\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上述代码会形成的路由如下")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),t._v("books"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$    name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" book"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("list")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),t._v("books"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("pk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$   name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" book"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("detail\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("）添加路由数据\nurlpatterns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nurlpatterns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urls\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者")]),t._v("\nurlpatterns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'^'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" include"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n")])])]),a("h4",{attrs:{id:"视图集中包含附加action"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视图集中包含附加action"}},[t._v("#")]),t._v(" 视图集中包含附加action")]),t._v(" "),a("p",[t._v("导入"),a("code",[t._v("rest_framework.decorators.action")]),t._v("装饰器可解决上面问题。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decorators "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" action\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookInfoViewSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mixins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ListModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mixins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RetrieveModelMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" GenericViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer\n\n    "),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detail"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#detail = False不生成正则匹配")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("latest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'put'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detail"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#detail = True生成正则匹配")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[a("strong",[t._v("要使用自动生成路由的方法，视图必须继承自视图集。")])]),t._v(" "),a("p",[t._v("除了"),a("code",[t._v("SimpleRouter")]),t._v(",还有"),a("code",[t._v("DefaultRouter")]),t._v("，区别在于后者能生成首页，而前者不能。")]),t._v(" "),a("p",[t._v("使用视图集只能处理前端通过request发过来的数据是表单或json数据的类型。")]),t._v(" "),a("h2",{attrs:{id:"_5-认证与授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-认证与授权"}},[t._v("#")]),t._v(" 5. 认证与授权")]),t._v(" "),a("p",[t._v("DRF 内置认证模块")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BaseAuthentication\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" SessionAuthentication\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" TokenAuthentication\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" RemoteUserAuthentication\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BasicAuthentication\n")])])]),a("blockquote",[a("p",[t._v("在每个视图中通过设置authentication_classess属性来设置")])]),t._v(" "),a("p",[a("u",[t._v("配置分为全局配置|局部配置")])]),t._v(" "),a("hr"),t._v(" "),a("h4",{attrs:{id:"baseauthentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#baseauthentication"}},[t._v("#")]),t._v(" BaseAuthentication")]),t._v(" "),a("p",[t._v("基本的授权。 每次都要在Header中把用户名和密码传给服务器。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serializer "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("views "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" APIView\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" viewsets\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BasicAuthentication\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IsAuthenticated\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("viewsets "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''\n        图书控制层\n    '''")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类属性")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证用户是否已经成功登录")]),t._v("\n    authentication_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("BasicAuthentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证用户的权限来限制访问")]),t._v("\n    permission_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IsAuthenticated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h4",{attrs:{id:"sessionauthentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sessionauthentication"}},[t._v("#")]),t._v(" SessionAuthentication")]),t._v(" "),a("p",[t._v("基于Django的session机制实现的")]),t._v(" "),a("h4",{attrs:{id:"tokenauthentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tokenauthentication"}},[t._v("#")]),t._v(" TokenAuthentication")]),t._v(" "),a("p",[t._v("缺点没有自动过期机制。一旦登录token永久。")]),t._v(" "),a("h4",{attrs:{id:"json-web-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#json-web-token"}},[t._v("#")]),t._v(" Json Web Token")]),t._v(" "),a("p",[t._v("JWT是在成功后，把用户的相关信息以及过期时间进行加密。然后生成一个token来返回给客户端。 客户端拿到可以存储起来。以后每次请求的时候都携带这个token。 服务器在接收到需要登录的API的请求。 对这个token进行解密。 然后获取用户过期时间和用户信息。 如果过期了或者用户的信息不对。都是认证失败")]),t._v(" "),a("h3",{attrs:{id:"_5-1-认证authentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-认证authentication"}},[t._v("#")]),t._v(" 5.1 认证Authentication")]),t._v(" "),a("p",[a("strong",[t._v("全局配置")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_AUTHENTICATION_CLASSES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.authentication.BasicAuthentication'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 基本表单认证")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.authentication.SessionAuthentication'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# session认证")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("局部配置")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" SessionAuthentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BasicAuthentication\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("views "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" APIView\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExampleView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    authentication_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SessionAuthentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" BasicAuthentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("认证失败会有两种可能的返回值：")]),t._v(" "),a("ul",[a("li",[t._v("401 Unauthorized 未认证")]),t._v(" "),a("li",[t._v("403 Permission Denied 权限被禁止")])]),t._v(" "),a("h3",{attrs:{id:"_5-2-权限permissions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-权限permissions"}},[t._v("#")]),t._v(" 5.2 权限Permissions")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IsAuthenticated\n")])])]),a("p",[t._v("权限控制可以限制用户对于视图的访问和对于具体数据对象的访问")]),t._v(" "),a("ul",[a("li",[t._v("在执行视图的dispatch()方法前，会先进行视图访问权限的判断")]),t._v(" "),a("li",[t._v("在通过get_object()获取具体对象时，会进行对象访问权限的判断")])]),t._v(" "),a("p",[a("strong",[t._v("全局配置")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_PERMISSION_CLASSES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.permissions.IsAuthenticated'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 授权访问")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("默认配置")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_PERMISSION_CLASSES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.permissions.AllowAny'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("局部配置")])]),t._v(" "),a("p",[t._v("也可以在具体的视图中通过permission_classes属性来设置")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IsAuthenticated\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("viewsets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ModelViewSet\n\nBooksModelViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ModelViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    permission_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IsAuthenticated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#登录授权用户")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("提供的权限")]),t._v(" "),a("ul",[a("li",[t._v("AllowAny 允许所有用户")]),t._v(" "),a("li",[t._v("IsAuthenticated 仅通过认证的用户")]),t._v(" "),a("li",[t._v("IsAdminUser 仅管理员用户")]),t._v(" "),a("li",[t._v("IsAuthenticatedOrReadOnly 认证的用户可以完全操作，否则只能get读取")])])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" SessionAuthentication "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Session 认证")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IsAuthenticated "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 权限")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("generics "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" RetrieveAPIView\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RetrieveAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查询")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 序列化")]),t._v("\n    authentication_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("SessionAuthentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    permission_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IsAuthenticated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h2",{attrs:{id:"_6-其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-其他"}},[t._v("#")]),t._v(" 6. 其他")]),t._v(" "),a("h3",{attrs:{id:"_6-1-限流throttling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-限流throttling"}},[t._v("#")]),t._v(" 6.1 限流Throttling")]),t._v(" "),a("blockquote",[a("p",[t._v("可以对接口访问的频次进行限制，以减轻服务器压力。")]),t._v(" "),a("p",[t._v("一般用于付费购买次数,投票等场景使用.")]),t._v(" "),a("p",[t._v("可以对接口访问的频次进行限制，以减轻服务器压力，"),a("strong",[t._v("主要用于反爬虫")])])]),t._v(" "),a("p",[a("strong",[t._v("全局配置")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_CLASSES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.throttling.AnonRateThrottle'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.throttling.UserRateThrottle'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_RATES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'anon'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'4/day'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匿名用户每天访问4次")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100/day'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 登录用户访问100次")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[a("code",[t._v("DEFAULT_THROTTLE_RATES")]),t._v(" 可以使用 "),a("code",[t._v("second")]),t._v(", "),a("code",[t._v("minute")]),t._v(", "),a("code",[t._v("hour")]),t._v(" 或"),a("code",[t._v("day")]),t._v("来指明周期。")]),t._v(" "),a("p",[t._v("限制视图接口被访问的频率次数 - 限制的条件(IP、id、唯一键)、频率周期时间(s、m、h)、频率的次数（3/s）")])]),t._v(" "),a("p",[a("strong",[t._v("局部配置")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("throttling "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UserRateThrottle\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("views "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" APIView "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 视图")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    \n    throttle_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserRateThrottle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("blockquote",[a("h4",{attrs:{id:"可选限流类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可选限流类"}},[t._v("#")]),t._v(" 可选限流类")]),t._v(" "),a("p",[t._v("DRF中，节流的类总共三个")]),t._v(" "),a("p",[t._v("1） "),a("code",[t._v("AnonRateThrottle")])]),t._v(" "),a("p",[t._v("限制所有匿名未认证用户，使用IP区分用户。")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("DEFAULT_THROTTLE_RATES['anon']")]),t._v(" 来设置频次")]),t._v(" "),a("p",[t._v("2）"),a("code",[t._v("UserRateThrottle")])]),t._v(" "),a("p",[t._v("限制认证用户，使用User id 来区分。")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("DEFAULT_THROTTLE_RATES['user']")]),t._v(" 来设置频次")]),t._v(" "),a("p",[t._v("如果想要针对不同类型的用户实现不同策略的节流，我们可以通过继承UserRateThrottle类，然后设置scope属性")]),t._v(" "),a("p",[t._v("然后再"),a("code",[t._v("settings.py")]),t._v("中配置")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AdminRateThrottle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserRateThrottle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    scope "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_RATES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'60/day'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1000/day'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("3）"),a("code",[t._v("ScopedRateThrottle")])]),t._v(" "),a("p",[t._v("限制用户对于每个视图的访问频次，使用ip或user id。")]),t._v(" "),a("p",[t._v("这个不管是登录还是未登录。都是根据scope来实现的。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    throttle_scope "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uploads'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authentication "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" SessionAuthentication "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Session认证")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IsAuthenticated "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 权限")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("generics "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" RetrieveAPIView "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 视图")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("throttling "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UserRateThrottle "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 限速")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BooksView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RetrieveAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer\n    authentication_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("SessionAuthentication"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    permission_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("IsAuthenticated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    throttle_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserRateThrottle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nREST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_CLASSES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.throttling.ScopedRateThrottle'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_RATES'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'contacts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1000/day'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uploads'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'20/day'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_6-2-过滤filtering"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-过滤filtering"}},[t._v("#")]),t._v(" 6.2 过滤Filtering")]),t._v(" "),a("p",[t._v("对于列表数据可能需要根据字段进行过滤，我们可以通过添加django-fitlter扩展来增强支持，实现了"),a("code",[t._v("ListModelMixin")]),t._v("扩展类及子类的视图类才能使用")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pip install django"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("filter")]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.2")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),t._v("\n")])])]),a("p",[t._v("在配置文件中增加过滤后端的设置")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("INSTALLED_APPS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'django_filters'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要注册应用，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nREST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_FILTER_BACKENDS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'django_filters.rest_framework.DjangoFilterBackend'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在视图中添加filter_fields属性，指定可以过滤的字段")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django_filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" DjangoFilterBackend\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("viewsets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Book"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookSerializer\n\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DjangoFilterBackend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    filter_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("book"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("?"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200501145515.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_6-3-排序orderingfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-排序orderingfilter"}},[t._v("#")]),t._v(" 6.3 排序OrderingFilter")]),t._v(" "),a("blockquote",[a("p",[t._v("对于列表数据，REST framework提供了"),a("strong",[t._v("OrderingFilter")]),t._v("过滤器来帮助我们快速指明数据按照指定字段进行排序")]),t._v(" "),a("p",[a("strong",[t._v("使用方法：")])]),t._v(" "),a("p",[t._v("在类视图中设置filter_backends，使用rest_framework.filters.OrderingFilter过滤器，REST framework会在请求的查询字符串参数中检查是否包含了ordering参数，如果包含了ordering参数，则按照ordering参数指明的排序字段对数据集进行排序。")]),t._v(" "),a("p",[t._v("前端可以传递的ordering参数的可选字段值需要在ordering_fields中指明。")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filters "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" OrderingFilter\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StudentListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Student"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" StudentModelSerializer\n    \n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OrderingFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ordering_fields = ('id', 'age')")]),t._v("\n    ordering_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__all__'")]),t._v("\n    \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 127.0.0.1:8000/books/?ordering=-id")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -id 表示针对id字段进行倒序排序")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# id  表示针对id字段进行升序排序")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200501145557.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果有ordering_fields")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# url输入的是该字段，就按该字段排序（ordering_fields必须是可以参与order_by()的字段，否则会报错）否则不排序")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果ordering_fields = '__all__':")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1. 如 url:/ordering = -sdfsfd，则 ordering = None，不排序")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 如 url:/ordering = -price, 则 ordering = -price，按-price排序")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果没有指定ordering_fields,")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1. 不参与序列化，如：sdsadf。则 ordering = None，不排序")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 参与序列化且是表字段，如：price，则 ordering = price, 按price排序，")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3. 参与序列化不是表字段，如：brand_name, 则 ordering = brand_name,报错（order_by(brand_name)出错")]),t._v("\n")])])]),a("p",[t._v("如果需要在过滤以后再次进行排序，则需要两者结合!")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("generics "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ListAPIView\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" students"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Student\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serializers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" StudentModelSerializer\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django_filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" DjangoFilterBackend\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Student3ListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Student"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" StudentModelSerializer\n    \n    filter_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'age'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sex'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 因为局部配置会覆盖全局配置,所以需要重新把过滤组件核心类再次声明,")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 否则过滤功能会失效")]),t._v("\n    filter_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OrderingFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("DjangoFilterBackend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    ordering_fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'age'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"_6-4-分页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-分页"}},[t._v("#")]),t._v(" 6.4 分页")]),t._v(" "),a("blockquote",[a("p",[t._v("REST framework提供了分页的支持。")]),t._v(" "),a("p",[t._v("我们可以在配置文件中设置全局的分页方式，如")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_PAGINATION_CLASS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.pagination.PageNumberPagination'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PAGE_SIZE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每页数目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200501145656.png",alt:""}})]),t._v(" "),a("p",[t._v("也可通过自定义Pagination类，来为视图添加不同分页行为。在视图中通过pagination_class属性来指明")]),t._v(" "),a("p",[a("strong",[t._v("1. PageNumberPagination")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pagination "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PageNumberPagination  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#分页")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LargeResultsSetPagination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("PageNumberPagination"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        配置分页规则\n    """')]),t._v("\n    page_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每页数目")]),t._v("\n    page_size_query_param "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'page_size'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 前端发送的页数关键字名，默认为"page"')]),t._v("\n    page_query_param "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'page'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 前端发送的每页数目关键字名，默认为None")]),t._v("\n    max_page_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 前端最多能设置的每页数量")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookDetailView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RetrieveAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer\n    \n    pagination_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LargeResultsSetPagination "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用到视图函数中")]),t._v("\n")])])]),a("p",[a("strong",[t._v("注意：如果在视图内关闭分页功能，只需在视图内设置")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("pagination_class = None\n")])])]),a("p",[a("strong",[t._v("2. LimitOffsetPagination")])]),t._v(" "),a("p",[t._v("http://127.0.0.1:8888/book/?limit=20&offset=10")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_PAGINATION_CLASS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.pagination.LimitOffsetPagination'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200501145742.png",alt:""}})]),t._v(" "),a("p",[t._v("可以在子类中定义的属性")]),t._v(" "),a("blockquote",[a("p",[t._v("default_limit 默认限制，默认值与"),a("code",[t._v("PAGE_SIZE")]),t._v("设置一直")]),t._v(" "),a("p",[t._v("limit_query_param limit参数名，默认'limit'")]),t._v(" "),a("p",[t._v("offset_query_param offset参数名，默认'offset'")]),t._v(" "),a("p",[t._v("max_limit 最大limit限制，默认None")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pagination "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" LimitOffsetPagination\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BookListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("order_by"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BookInfoSerializer\n    pagination_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LimitOffsetPagination\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 127.0.0.1:8000/books/?offset=3&limit=2")]),t._v("\n")])])]),a("h2",{attrs:{id:"_7-异常处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-异常处理"}},[t._v("#")]),t._v(" 7. 异常处理")]),t._v(" "),a("p",[t._v("REST framework提供了异常处理，我们可以自定义异常处理函数。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("views "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" exception_handler\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("custom_exception_handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先调用REST framework默认的异常处理方法获得标准错误响应对象")]),t._v("\n    response "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exception_handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在此处补充自定义的异常处理")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" response "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'status_code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status_code\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response\n")])])]),a("p",[a("strong",[t._v("全局配置")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'EXCEPTION_HANDLER'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my_project.my_app.utils.custom_exception_handler'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#定义处理异常的路径，以项目实际为准")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("如果未声明，会采用默认的方式，如下")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'EXCEPTION_HANDLER'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.views.exception_handler'")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("h4",{attrs:{id:"rest-framework定义的异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rest-framework定义的异常"}},[t._v("#")]),t._v(" REST framework定义的异常")]),t._v(" "),a("p",[t._v("APIException 所有异常的父类")]),t._v(" "),a("p",[t._v("ParseError 解析错误")]),t._v(" "),a("p",[t._v("AuthenticationFailed 认证失败")]),t._v(" "),a("p",[t._v("NotAuthenticated 尚未认证")]),t._v(" "),a("p",[t._v("PermissionDenied 权限决绝")]),t._v(" "),a("p",[t._v("NotFound 未找到")]),t._v(" "),a("p",[t._v("MethodNotAllowed 请求方式不支持")]),t._v(" "),a("p",[t._v("NotAcceptable 要获取的数据格式不支持")]),t._v(" "),a("p",[t._v("Throttled 超过限流次数")]),t._v(" "),a("p",[t._v("ValidationError 校验失败")])]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5d064f856fb9a07f0420478a",target:"_blank",rel:"noopener noreferrer"}},[t._v("掘金"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);