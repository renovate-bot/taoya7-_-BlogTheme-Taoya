(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{682:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Django框架内置的服务器，仅适用于开发目的。并且不能很好的扩展。生产部署环境我们选用WSGI兼容服务器。")]),t._v(" "),a("h3",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[t._v("#")]),t._v(" 环境")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("CenterOS")])]),t._v(" "),a("p",[a("code",[t._v("Python 3.7.6")])]),t._v(" "),a("p",[a("code",[t._v("Nginx 1.16")])])]),t._v(" "),a("h2",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),a("p",[a("strong",[t._v("基本配置")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("DEBUG "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" FALSE\nALLOWSE_HOST"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保持https连接的时间")]),t._v("\nSECURE_HSTS_SECONDS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),t._v("\nSECURE_HSTS_INCLUDE_SUBDOMAINS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\nSECURE_HSTS_PRELOAD "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自动重定向到安全连接（走HTTP自动重定向到https）")]),t._v("\nSECURE_SSL_REDIRECT "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 避免跨站脚本攻击风险")]),t._v("\nSECURE_CONTENT_TYPE_NOSNIFF "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''\n避免会自动推断内容去执行\n'''")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 避免跨站脚本攻击（XSS）")]),t._v("\nSECURE_BROWSER_XSS_FILTER"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v("'''\n避免js脚本攻击\n'''")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# COOKIE只能通过HtTPS进行传输")]),t._v("\nSESSION_COOKIE_SECURE"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\nCSRF_COOKIE_SECURE "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 防止点击劫持攻击手段（不允许使用<iframe>标签进行加载）")]),t._v("\nX_FRAME_OPTIONS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DENY'")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200503152313.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"uwsgi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uwsgi"}},[t._v("#")]),t._v(" uwsgi")]),t._v(" "),a("p",[t._v("在项目根目录创建"),a("code",[t._v("uwsgi.ini")]),t._v(" 配置文件")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("[uwsgi]\n# 直接做web服务器使用\nhttp = 0.0.0.0:8080\n# 项目目录\nchdir = /home/Linis/code/test\n# wsgi.py文件的目录\nwsgi-file = /home/Linis/code/test/try/wsgi.py\n# 指定启动的工作进程数\nprocesses = 4\n# 指定工作进程中的线程数\nthreads = 2\n\n# 使用nginx连接时使用\nsocket = 127.0.0.1:8899\n")])])]),a("p",[t._v("进入项目根目录执行"),a("code",[t._v("uwsgi uwsgi.ini")])]),t._v(" "),a("p",[t._v("测试访问正常运行")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200503155502.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("运行与停止")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("启动：\nuwsgi --ini uwsgi.ini\n停止：\nuwsgi --stop uwsgi.pid\n")])])]),a("h3",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" Nginx")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("upstream django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8899")]),t._v(";\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nserver\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(";\n    server_name test.itaolaity.com;\n    \n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t\tinclude uwsgi_params;\n\t\tuwsgi_pass django;\n  \t\tuwsgi_param UWSGI_SCRIPT try.wsgi;\n \t\tuwsgi_param UWSGI_CHDIR /home/Linis/code/test/;\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tlocation /static "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\talias /home/Linis/code/test/static;\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("访问域名没有问题可以正常访问。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200503155641.png",alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("h3",{attrs:{id:"静态资源访问问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源访问问题"}},[t._v("#")]),t._v(" 静态资源访问问题")])]),t._v(" "),a("p",[t._v("现在"),a("code",[t._v("settings.py")]),t._v("配置静态资源")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("STATIC_URL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/static/'")]),t._v("\nSTATICFILES_DIRS "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BASE_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"static"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BASE_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"front"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"static"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nSTATIC_ROOT "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BASE_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"static"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 收集Django静态资源到指定目录下")]),t._v("\n")])])]),a("p",[t._v("上传到服务器执行")]),t._v(" "),a("p",[a("code",[t._v("python manage.py collectstatic")])]),t._v(" "),a("p",[t._v("将静态文件打包至项目根目录下的"),a("code",[t._v("static")]),t._v("目录里")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200503161839.png",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v("uwsgi服务器默认不托管静态资源，一般需要配合Nginx使用(静态资源交给Nginx处理)")])]),t._v(" "),a("p",[t._v("Nginx的核心配置")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("# 收集静态文件之后，让Nginx提供静态文件，需要在Nginx配置文件中增加以下配置\nlocation /static {\n\t\talias /home/Linis/code/test/static;\n\t}\n")])])]),a("p",[t._v("项目上传到服务器可以看到正常链接到")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://cdn.itaolaity.com/20200503161950.png",alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("h3",{attrs:{id:"uwsgi-后台执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uwsgi-后台执行"}},[t._v("#")]),t._v(" uWSGI 后台执行")])]),t._v(" "),a("p",[a("code",[t._v("-d")]),t._v(" 参数")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("uwsgi -d --ini uwsgi.ini\n")])])]),a("div",{staticClass:"custom-block warning"},[a("h3",{attrs:{id:"虚拟环境使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟环境使用"}},[t._v("#")]),t._v(" 虚拟环境使用")])]),t._v(" "),a("p",[a("strong",[t._v("安装uwsgi")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" uwsgi\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看")]),t._v("\nuwsgi --version\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),t._v(".18\n")])])]),a("p",[a("strong",[t._v("退出虚拟环境")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("deactivate\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);